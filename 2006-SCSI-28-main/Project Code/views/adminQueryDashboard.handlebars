<section class="py-4">
  <div class="container">
    <div class="bb-hero-card bg-success-subtle rounded-3 p-4 p-md-5">
      
      <div class="row align-items-center g-4">
        <div class="col-lg-8 mx-auto text-center">
          <h1 class="display-6 mb-3 text-success">Admin Query Dashboard</h1>
          <p class="lead mb-4">
            Users have some questions about e-waste recycling. Respond to their queries 
            to provide guidance to make recycling easier and more effective.
          </p>
        </div>
      </div>

      <div class="row g-4 mt-3">

        <div class="col-md-6">
          <div class="card border-0 shadow-sm h-100 bg-light">
            <div class="card-body text-center p-4">
              <div class="mb-3">
                <i class="bi bi-chat-dots-fill text-primary" style="font-size: 3rem;"></i>
              </div>
              <h3 class="card-title h4 mb-3">Queries from Users</h3>
              <p class="card-text text-muted mb-4">
                View all submitted questions and respond to them. 
              </p>

              <div class="d-grid gap-3">
                <a href="/adminQuery/Dashboard/queryList" class="btn btn-outline-primary btn-lg">
                  <i class="bi bi-list-ul me-2"></i>View Submitted Queries
                </a>
                <a href="/adminQuery/Dashboard/queryList?status=Pending" class="btn btn-outline-danger btn-lg">
                  <i class="bi bi-hourglass-split me-2"></i>View Pending Queries
                </a>
                <a href="/adminQuery/Dashboard/queryList?status=Answered" class="btn btn-outline-success btn-lg">
                  <i class="bi bi-check-circle-fill me-2"></i>View Answered Queries
                <a href="/adminQuery/Dashboard/flaggedUsers" class="btn btn-outline-warning btn-lg">
                  <i class="bi bi-exclamation-triangle me-2"></i>View Flagged Users
                </a>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card border-0 shadow-sm h-100 bg-light">
            <div class="card-body text-center p-4">
              <h3 class="card-title h4 mb-3">Queries Statistics</h3>
              <canvas id="queryChart"></canvas>

              <div class="mt-4">
                <h5>Flagged Users</h5>
                {{#if flaggedUsersCount}}
                  <p class="text-danger fw-bold">{{flaggedUsersCount}} user(s) flagged for excessive queries</p>
                {{else}}
                  <p class="text-success">No flagged users</p>
                {{/if}}
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
  (function () {
    const el = document.getElementById('queryChart');
    if (!el) return;
    const ctx = el.getContext('2d');

    const total = {{{json total}}};
    const answered = {{{json answered}}};
    const pending = {{{json pending}}};

    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Answered', 'Pending'],
        datasets: [{
          data: [answered, pending],
          backgroundColor: ['#28a745', '#ffc107'],
          borderColor: ['#ffffff', '#ffffff'],
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          tooltip: {
            callbacks: {
              label: function (context) {
                const label = context.label || '';
                const value = context.raw || 0;
                const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                return `${label}: ${value} (${pct}%)`;
              }
            }
          }
        }
      }
    });
  })();
</script>
